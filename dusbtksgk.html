<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>두근두근! 짝꿍 뽑기</title>
    <style>
        /* 귀여운 폰트 로드 */
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        :root {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --machine-bg: #f0e8ff;
            --window-bg: rgba(255, 255, 255, 0.5);
            --text-color: #333;
            --lever-bg: #ff7e5f;
            --lever-shadow: #c85a40;
            --chute-bg: #d1c4e9;
            --capsule-border: #a89bbd;
            --input-bg: #fff;
            --error-color: #d9534f;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Jua', sans-serif;
            background: var(--bg-gradient);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .gacha-machine {
            background-color: var(--machine-bg);
            border-radius: 30px;
            padding: 25px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), inset 0 0 15px rgba(255,255,255,0.8);
            border: 5px solid #fff;
        }

        h1 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 2.2rem;
        }
        
        /* 캡슐이 들어있는 창 */
        .machine-window {
            background: var(--window-bg);
            border-radius: 20px;
            min-height: 150px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-content: flex-start;
            border: 3px solid var(--capsule-border);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow-y: auto;
            max-height: 200px;
        }

        .machine-window.shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* 참가자 캡슐 스타일 */
        .participant-capsule {
            background-color: #fff;
            border: 2px solid var(--capsule-border);
            color: var(--text-color);
            padding: 5px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease-in-out;
        }
        .participant-capsule:hover {
            transform: scale(1.05);
        }
        
        .remove-btn {
            background: none; border: none; color: #999;
            cursor: pointer; margin-left: 8px; font-size: 1.2rem;
            padding: 0; line-height: 1;
        }
        .remove-btn:hover { color: var(--error-color); }

        .control-panel {
            background-color: #e3d9f5;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .input-group:last-child { margin-bottom: 0; }

        input[type="text"] {
            flex-grow: 1;
            padding: 10px 15px;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 2px solid var(--capsule-border);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Jua', sans-serif;
            outline: none;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus { border-color: var(--lever-bg); }

        button {
            padding: 10px 15px;
            background-color: #9076c4;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Jua', sans-serif;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap;
        }
        button:hover { background-color: #765aae; }
        
        /* 뽑기 레버(버튼) */
        .pull-lever-section { text-align: center; margin-bottom: 25px; }

        #pull-btn {
            width: 100px; height: 100px;
            background-color: var(--lever-bg);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 2rem;
            font-family: 'Jua', sans-serif;
            cursor: pointer;
            box-shadow: 0 8px 0 var(--lever-shadow);
            transition: all 0.1s ease-out;
        }
        #pull-btn:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 var(--lever-shadow);
        }

        /* 결과가 나오는 곳 */
        .prize-chute {
            background-color: var(--chute-bg);
            border-radius: 15px;
            min-height: 80px;
            padding: 20px;
            text-align: center;
            font-size: 1.3rem;
            color: var(--text-color);
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.15);
            line-height: 1.5;
            transition: background-color 0.3s;
        }
        .prize-chute .highlight {
            color: #d81b60;
            font-size: 1.5rem;
        }

        /* 모바일 화면 대응 */
        @media (max-width: 480px) {
            h1 { font-size: 1.8rem; }
            .gacha-machine { padding: 15px; }
            .control-panel { padding: 15px; }
            #pull-btn { width: 80px; height: 80px; font-size: 1.5rem; }
            .prize-chute { font-size: 1.1rem; }
            .prize-chute .highlight { font-size: 1.3rem; }
        }

    </style>
</head>
<body>

    <div class="gacha-machine">
        <h1>두근두근!<br>짝꿍 뽑기</h1>

        <!-- 참가자 캡슐 창 -->
        <div class="machine-window" id="participantList"></div>

        <!-- 조작 패널 -->
        <div class="control-panel">
            <div class="input-group">
                <input type="text" id="addParticipantInput" placeholder="참가자 닉네임 추가">
                <button onclick="addParticipant()">추가</button>
            </div>
            <div class="input-group">
                <input type="text" id="seedInput" placeholder="비밀 시드 (암호)">
            </div>
            <div class="input-group">
                <input type="text" id="nicknameInput" placeholder="내 닉네임">
            </div>
        </div>

        <!-- 뽑기 버튼 -->
        <div class="pull-lever-section">
            <button id="pull-btn" onclick="findPartner()">뽑기!</button>
        </div>
        
        <!-- 결과 표시 -->
        <div class="prize-chute" id="result">
            캡슐이 나올 곳
        </div>
    </div>
    
    <!-- 뽑기 소리 (효과음) -->
    <audio id="gacha-sound" src="https://www.myinstants.com/media/sounds/genshin-impact-wish-pull-single.mp3" preload="auto"></audio>


    <script>
        // 초기 참가자 목록 (새로운 닉네임 추가)
        let participants = ['시현', '이셜', '류하', '참치', '여뉴', '츠온', '예륜', '련예', '예월'];

        const participantListElem = document.getElementById('participantList');
        const addParticipantInput = document.getElementById('addParticipantInput');
        const nicknameInput = document.getElementById('nicknameInput');
        const resultElem = document.getElementById('result');
        const gachaSound = document.getElementById('gacha-sound');
        
        function renderParticipants() {
            participantListElem.innerHTML = '';
            participants.forEach(name => {
                const capsule = document.createElement('div');
                capsule.className = 'participant-capsule';
                capsule.innerHTML = `
                    <span>${name}</span>
                    <button class="remove-btn" onclick="removeParticipant('${name}')" title="삭제">×</button>
                `;
                participantListElem.appendChild(capsule);
            });
        }

        function addParticipant() {
            const name = addParticipantInput.value.trim();
            if (name === "") { resultElem.textContent = '닉네임을 입력해주세요.'; return; }
            if (participants.includes(name)) { resultElem.textContent = '이미 있는 닉네임이에요!'; return; }
            participants.push(name);
            addParticipantInput.value = '';
            renderParticipants();
        }
        
        function removeParticipant(name) {
            participants = participants.filter(p => p !== name);
            renderParticipants();
        }
        
        function generateFixedPairings() {
            const secretSeed = document.getElementById('seedInput').value.trim();

            if (secretSeed === "") {
                resultElem.textContent = '비밀 시드(암호)를 입력해야 해요!';
                return null;
            }
            if (participants.length < 2) {
                resultElem.textContent = '참가자가 2명 이상 필요해요!';
                return null;
            }

            const shuffled = [...participants];
            const seededRandom = mulberry32(cyrb53(secretSeed));
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            const pairings = {};
            for (let i = 0; i < shuffled.length; i++) {
                pairings[shuffled[i]] = shuffled[(i + 1) % shuffled.length];
            }
            return pairings;
        }

        function findPartner() {
            // 1. 애니메이션과 소리 효과
            participantListElem.classList.add('shake');
            gachaSound.currentTime = 0;
            gachaSound.play();
            resultElem.innerHTML = "두구두구두구....!";

            // 0.5초 후 애니메이션 클래스 제거
            setTimeout(() => {
                participantListElem.classList.remove('shake');
            }, 500);

            // 1초 후 결과 표시 (기대감 증폭!)
            setTimeout(() => {
                const pairings = generateFixedPairings();
                if (!pairings) return; // 유효성 검사 실패 시 함수 종료
                
                const nickname = nicknameInput.value.trim();
                if (nickname === "") {
                    resultElem.textContent = "결과를 확인할 내 닉네임을 입력하세요!";
                    return;
                }

                const partner = pairings[nickname];
                if (partner) {
                    resultElem.innerHTML = `<strong>${nickname}</strong> 님은... <strong class="highlight">${partner}</strong> 님의<br>소개서를 써주세요!`;
                } else {
                    resultElem.innerHTML = `<strong>'${nickname}'</strong> 님은 참가자 목록에 없어요.<br>닉네임을 확인하거나 추가해주세요!`;
                }
            }, 1000);
        }

        addParticipantInput.addEventListener('keyup', e => e.key === 'Enter' && addParticipant());
        nicknameInput.addEventListener('keyup', e => e.key === 'Enter' && findPartner());
        
        window.onload = renderParticipants;

        function cyrb53(str, seed=0){let h1=0xdeadbeef^seed,h2=0x41c6ce57^seed;for(let i=0,ch;i<str.length;i++){ch=str.charCodeAt(i);h1=Math.imul(h1^ch,2654435761);h2=Math.imul(h2^ch,1597334677);}h1=Math.imul(h1^(h1>>>16),2246822507)^Math.imul(h2^(h2>>>13),3266489909);h2=Math.imul(h2^(h2>>>16),2246822507)^Math.imul(h1^(h1>>>13),3266489909);return 4294967296*(2097151&h2)+(h1>>>0);}
        function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296;}}
    </script>

</body>
</html>
