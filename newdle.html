<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello, Newdle!</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Pretendard', sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        h1 {
            font-size: 2.2rem;
            color: #3998EB;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #666;
            font-size: 0.9rem;
        }

        .timer {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #3998EB;
            margin-bottom: 1rem;
        }

        main {
            flex: 1;
        }

        .game-container {
            background: white;
            border-radius: 12px;
            padding: 1.2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .guesses {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 1.2rem;
            padding: 0.5rem;
            background: #f5f7fa;
            border-radius: 8px;
        }

        .guess-row {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            flex-wrap: wrap; /* Allow wrapping for very long words */
        }

        .guess-cell {
            width: 2rem;
            height: 2rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            animation: flip 0.5s;
            /* --- ìƒ‰ìƒ ì •ì˜ --- */
            border: 1px solid transparent; /* Add border for definition */
        }

        .correct {
            background-color: #69D953; /* 7134297 */
            color: white;
            border-color: #57D57E;
        }

        .present {
            background-color: #F5D139; /* 16374097 */
            color: #504808; /* Darker text for yellow */
            border-color: #E6D342;
        }

        .absent {
            /* background-color: #EFEFEF; */ /* 15724527 - Very light, use darker */
            background-color: #9e9e9e; /* Using the original darker absent color */
            color: white;
            border-color: #888888;
        }

        .excess {
            background-color: #ef5350; /* Using CSS defined red */
            color: white;
            border-color: #d32f2f;
        }
        /* ----------------------- */

        @keyframes flip {
            0% { transform: rotateX(0); }
            50% { transform: rotateX(90deg); background-color: #ddd; } /* Mid-flip color */
            100% { transform: rotateX(0); }
        }

        .input-area {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        input {
            flex: 1;
            padding: 0.7rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        button {
            padding: 0.7rem 1rem;
            background: #3998EB;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover:not(:disabled) {
            background: #2b85d0; /* Slightly darker on hover */
        }

        button:disabled {
            background: #bdbdbd; /* Lighter gray for disabled */
            cursor: not-allowed;
        }

        .message {
            margin: 0.8rem 0;
            padding: 0.8rem;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease-out, background-color 0.3s, color 0.3s;
            min-height: 1.5em; /* Prevent layout shift */
        }

        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
            opacity: 1;
        }

        .error {
            background-color: #ffebee;
            color: #c62828;
            opacity: 1;
        }

        .easter-egg {
            background-color: #e3f2fd;
            color: #1565c0;
            opacity: 1;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }

        .toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .toolbar button {
            flex: 1;
            min-width: 100px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* Darker overlay */
            align-items: center;
            justify-content: center;
            z-index: 10;
            padding: 1rem; /* Padding for smaller screens */
        }

        .modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            width: 90%;
            max-width: 450px; /* Slightly wider for results */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-height: 90vh; /* Limit height */
            overflow-y: auto; /* Allow scrolling if content exceeds height */
        }

        .modal-title {
            font-size: 1.3rem; /* Larger title */
            font-weight: 600;
            margin-bottom: 1rem;
            color: #3998EB;
            text-align: center;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        /* Style for result grid within modal */
        #resultContent .result-grid {
            font-family: 'Courier New', Courier, monospace; /* Monospace for grid alignment */
            line-height: 1.3;
            font-size: 1.1rem; /* Adjust size as needed */
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto; /* Scroll if grid is too wide */
            text-align: center; /* Center the grid */
            margin: 1rem 0;
        }
         /* Style for URL in modal */
        #resultContent .result-url {
            font-size: 0.85rem;
            color: #555;
            word-break: break-all; /* Wrap long URLs */
            margin-top: 1rem;
            text-align: center;
        }
         /* Style for result summary text */
        #resultContent .result-summary {
            font-weight: 500;
            text-align: center;
            margin-bottom: 1rem;
        }


        footer {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.8rem;
            color: #888;
        }

        @media (max-width: 480px) {
             h1 { font-size: 1.8rem; }
            .guess-cell {
                width: 1.8rem;
                height: 1.8rem;
                font-size: 0.8rem;
            }

            .toolbar {
                flex-direction: column;
            }

            .input-area {
                flex-direction: column;
            }

            input, button {
                width: 100%;
            }
            .modal-content {
                 padding: 1rem;
            }
            .modal-title {
                 font-size: 1.1rem;
            }
            #resultContent .result-grid {
                 font-size: 0.9rem; /* Smaller grid on mobile */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ë‰´ë“¤</h1>
            <div class="subtitle">í•œ ì—¬ Newddle</div>
        </header>

        <div class="timer" id="timer">00:00</div>

        <main>
            <div class="game-container">
                <div class="guesses" id="guesses">
                    <!-- ì¶”ì¸¡ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </div>

                <div class="input-area">
                    <input type="text" id="guessInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
                    <button id="submitBtn">ì œì¶œ</button>
                </div>

                <div class="message" id="message"></div>

                <div class="stats">
                    <div id="guessCount">ì‹œë„: 0</div>
                    <div id="gameMode">ê¸°ë³¸ ëª¨ë“œ</div>
                </div>
            </div>

            <div class="toolbar">
                <button id="customBtn">ì»¤ìŠ¤í…€ ë‹¨ì–´</button>
                <button id="shareBtn" disabled>ê²°ê³¼ ê³µìœ </button> <!-- Changed text -->
                <button id="resetBtn">ìƒˆ ê²Œì„</button>
            </div>
        </main>

        <footer>
            Made by ì—¬ë‰´
        </footer>
    </div>

    <!-- ì»¤ìŠ¤í…€ ë‹¨ì–´ ëª¨ë‹¬ -->
    <div class="modal" id="customModal">
        <div class="modal-content">
            <div class="modal-title">ì»¤ìŠ¤í…€ ë‹¨ì–´ ì„¤ì •</div>
            <p style="font-size: 0.9rem; color: #555; margin-bottom: 1rem;">ê²Œì„ì„ ë§Œë“¤ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ìƒì„±ëœ URLì„ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì—¬ ê²Œì„ì— ë„ì „í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <input type="text" id="customWordInput" placeholder="ì»¤ìŠ¤í…€ ë‹¨ì–´ ì…ë ¥" style="width: 100%; margin: 1rem 0; padding: 0.7rem; border: 1px solid #ccc; border-radius: 6px;">
             <div class="modal-actions">
                 <button id="cancelCustom" style="background-color: #757575;">ì·¨ì†Œ</button>
                <button id="saveCustom">URL ìƒì„± ë° ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <!-- ê²°ê³¼ ëª¨ë‹¬ -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <div class="modal-title">ê²Œì„ ê²°ê³¼</div>
            <div id="resultContent" style="margin-bottom: 1rem;">
                 <!-- ê²°ê³¼ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
            <div class="modal-actions">
                <button id="closeResult" style="background-color: #757575;">ë‹«ê¸°</button>
                <button id="copyResult">í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- ê¸°ë³¸ ì„¤ì • ë° ìš”ì†Œ ---
            let targetWord = "íŠ¸ìœ„í„°ì•„ì´ë””ëŠ”@kjy2604â™¡"; // ê¸°ë³¸ ë‹¨ì–´
            let guessCount = 0;
            let gameOver = false;
            let startTime = new Date();
            let elapsedTime = 0;
            let timerInterval;
            let isCustomMode = false;
            let allGuessResults = []; // <<--- ì‹œê°ì  ê²°ê³¼ ê³µìœ ë¥¼ ìœ„í•´ ì¶”ê°€

            const guessesContainer = document.getElementById('guesses');
            const guessInput = document.getElementById('guessInput');
            const submitBtn = document.getElementById('submitBtn');
            const messageEl = document.getElementById('message');
            const guessCountEl = document.getElementById('guessCount');
            const timerEl = document.getElementById('timer');
            const gameModeEl = document.getElementById('gameMode');
            const customBtn = document.getElementById('customBtn');
            const shareBtn = document.getElementById('shareBtn');
            const resetBtn = document.getElementById('resetBtn');
            const customModal = document.getElementById('customModal');
            const customWordInput = document.getElementById('customWordInput');
            const saveCustomBtn = document.getElementById('saveCustom');
            const cancelCustomBtn = document.getElementById('cancelCustom');
            const resultModal = document.getElementById('resultModal');
            const resultContent = document.getElementById('resultContent');
            const copyResultBtn = document.getElementById('copyResult');
            const closeResultBtn = document.getElementById('closeResult');

            // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
            // UTF-8ì„ ì§€ì›í•˜ëŠ” Base64 ì¸ì½”ë”© í•¨ìˆ˜
            function encodeBase64(str) {
                try {
                    return btoa(unescape(encodeURIComponent(str)));
                } catch (e) {
                    console.error("Base64 ì¸ì½”ë”© ì˜¤ë¥˜:", e);
                    return ""; // ì˜¤ë¥˜ ì‹œ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
                }
            }

            // UTF-8ì„ ì§€ì›í•˜ëŠ” Base64 ë””ì½”ë”© í•¨ìˆ˜
            function decodeBase64(str) {
                try {
                    // URL-safe Base64 ë³€í™˜ (í˜¹ì‹œ +ë‚˜ /ê°€ _ë‚˜ -ë¡œ ë°”ë€Œì—ˆì„ ê²½ìš° ëŒ€ë¹„)
                    const base64 = str.replace(/-/g, '+').replace(/_/g, '/');
                     // íŒ¨ë”© ì¶”ê°€ (Base64 ê¸¸ì´ëŠ” 4ì˜ ë°°ìˆ˜ì—¬ì•¼ í•¨)
                    const padding = '='.repeat((4 - base64.length % 4) % 4);
                    return decodeURIComponent(escape(atob(base64 + padding)));
                } catch (e) {
                    console.error("Base64 ë””ì½”ë”© ì˜¤ë¥˜:", e, "ì…ë ¥ê°’:", str);
                    return "ë””ì½”ë”©ì˜¤ë¥˜"; // ì˜¤ë¥˜ ì‹œ í‘œì‹œ
                }
            }

            // ì‹œê°„ í˜•ì‹í™” í•¨ìˆ˜
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

             // --- ì´ìŠ¤í„°ì—ê·¸ ì •ì˜ ---
             const countEasterEggs = {
                 5: "ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•´ë³´ì„¸ìš©.",
                 10: "ë ›ì¸ ë¼ë¦¿",
                 20: "í˜ë“¤ì§€ì•Šì•„ê±°ì¹œì„¸ìƒì†ì—ë›°ì–´ë“ ê±´ë„ˆë‹ˆê¹Œ ìœ ì˜¤ì¼€",
                 30: "í¬ê¸°ëŠ” ë°°ì¶”ì…€ë•Œë§Œí•˜ëŠ”ê²ƒ.",
                 50: "ëŒ€ë‹¨í•˜ì‹­ë‹ˆë‹¤...",
                 83: "ì—¬ë‰´ìƒì¼ 20100803â™¡",
                 100: "ë‹¹ì‹ ì„ ê°œë ˆì „ë“œë¡œì„ëª…í•©ë‹ˆë‹¤"
             };
             const wordEasterEggs = {
                 "ì‚¬ë‘": "â™¡",
                 "ìœ¤ì‚°í•˜": "ì—¬ë‰´ì˜ ì‚¬ë‘",
                 "ìœ¡ì„±ì¬": "ìœ¤ì‚°í•˜ìœ¡ì„±ì¬ë‘˜ì¤‘ë­˜ë¨¼ì €ì³£ì„ê¹Œ?",
                 "kjy": "í—‰!! ëª…íƒì •",
                 "kjy2604": "ì½”ë‚œì´ë‹¤",
                 "ë­ì§€": "ê·¸ëŸ¬ê²Œìš”",
                 "ì—¬ë‰´": "ì™œìš”",
                 "í¬ê¸°": "í•˜ì§€ë§ˆ!! ìœ¡ìº”ë‘ì‡"
             };

            // --- ê²Œì„ ì´ˆê¸°í™” ë° ì‹œì‘ ---
            function initializeGame() {
                 // URL ë§¤ê°œë³€ìˆ˜ ì²˜ë¦¬ (ì»¤ìŠ¤í…€ ë‹¨ì–´ìš©) - ë§¨ ì²˜ìŒ í•œ ë²ˆë§Œ ì‹¤í–‰
                 const urlParams = new URLSearchParams(window.location.search);
                 if (urlParams.has('word')) {
                     const encodedWord = urlParams.get('word');
                     const decodedWord = decodeBase64(encodedWord); // ìˆ˜ì •ëœ ë””ì½”ë”© í•¨ìˆ˜ ì‚¬ìš©

                     if (decodedWord && decodedWord !== "ë””ì½”ë”©ì˜¤ë¥˜") {
                         targetWord = decodedWord;
                         isCustomMode = true;
                         gameModeEl.textContent = "ì»¤ìŠ¤í…€ ëª¨ë“œ";
                         console.log("ì»¤ìŠ¤í…€ ëª¨ë“œ ë¡œë“œë¨. ì •ë‹µ:", targetWord);
                         // ì„±ê³µì ìœ¼ë¡œ ë¡œë“œ í›„ URLì—ì„œ íŒŒë¼ë¯¸í„° ì œê±° (ìƒˆë¡œê³ ì¹¨ ì‹œ ê¸°ë³¸ ë‹¨ì–´ë¡œ ëŒì•„ê°€ì§€ ì•Šë„ë¡)
                         // history.replaceState(null, '', window.location.pathname); // ì£¼ì„ ì²˜ë¦¬: ê³µìœ  URL ìœ ì§€ ìœ„í•´
                     } else {
                         showMessage('ì»¤ìŠ¤í…€ ë‹¨ì–´ ë¡œë”© ì‹¤íŒ¨!', 'error');
                         gameModeEl.textContent = "ê¸°ë³¸ ëª¨ë“œ"; // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ëª¨ë“œë¡œ
                     }
                 } else {
                     isCustomMode = false;
                     gameModeEl.textContent = "ê¸°ë³¸ ëª¨ë“œ";
                 }

                 resetGame(); // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
                 startTimer();
                 guessInput.focus();
             }

            // ê²Œì„ ë¦¬ì…‹ í•¨ìˆ˜
            function resetGame() {
                guessCount = 0;
                gameOver = false;
                allGuessResults = []; // <<--- ê²°ê³¼ ê¸°ë¡ ì´ˆê¸°í™”
                guessesContainer.innerHTML = '';
                guessCountEl.textContent = `ì‹œë„: 0`;
                guessInput.value = '';
                guessInput.disabled = false;
                submitBtn.disabled = false;
                shareBtn.disabled = true;
                messageEl.className = 'message';
                messageEl.textContent = ''; // ë©”ì‹œì§€ ë‚´ìš©ë„ ì´ˆê¸°í™”

                // íƒ€ì´ë¨¸ ë¦¬ì…‹ ë° ì¬ì‹œì‘
                clearInterval(timerInterval);
                startTime = new Date();
                elapsedTime = 0;
                timerEl.textContent = '00:00';
                startTimer();

                // ì´ì „ ì¶•í•˜ ë©”ì‹œì§€ ì œê±° (ë§Œì•½ ìˆì—ˆë‹¤ë©´)
                const existingCongrats = document.querySelector('.congrats-message');
                if (existingCongrats) {
                    existingCongrats.remove();
                }

                guessInput.focus();
            }

            // íƒ€ì´ë¨¸ ì‹œì‘ í•¨ìˆ˜
            function startTimer() {
                clearInterval(timerInterval); // ê¸°ì¡´ íƒ€ì´ë¨¸ ì¤‘ë³µ ë°©ì§€
                timerInterval = setInterval(function() {
                    if (!gameOver) {
                        const now = new Date();
                        elapsedTime = Math.floor((now - startTime) / 1000);
                        timerEl.textContent = formatTime(elapsedTime);
                    } else {
                        clearInterval(timerInterval); // ê²Œì„ ì¢…ë£Œ ì‹œ íƒ€ì´ë¨¸ í™•ì‹¤íˆ ë©ˆì¶¤
                    }
                }, 1000);
            }

             // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
             function showMessage(text, type, duration = 3000) {
                 messageEl.textContent = text;
                 // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±° í›„ ìƒˆ í´ë˜ìŠ¤ ì¶”ê°€ (messageëŠ” ê¸°ë³¸)
                 messageEl.className = 'message';
                 void messageEl.offsetWidth; // ë¦¬í”Œë¡œìš° ê°•ì œí•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘
                 messageEl.classList.add(type);
                 messageEl.style.opacity = '1'; // í‘œì‹œ

                 // ì„±ê³µ ë©”ì‹œì§€ê°€ ì•„ë‹ˆë©´ ì¼ì • ì‹œê°„ í›„ ì‚¬ë¼ì§
                 if (type !== 'success') {
                     setTimeout(() => {
                         messageEl.style.opacity = '0';
                         // ì‚¬ë¼ì§„ í›„ í´ë˜ìŠ¤ ì œê±°í•˜ì—¬ ë‹¤ìŒ ë©”ì‹œì§€ ì¤€ë¹„
                         setTimeout(() => {
                             if (messageEl.textContent === text) { // ë‹¤ë¥¸ ë©”ì‹œì§€ë¡œ ë®ì–´ì“°ì§€ ì•Šì•˜ë‹¤ë©´
                                 messageEl.className = 'message';
                                 messageEl.textContent = '';
                             }
                         }, 300); // opacity ì „í™˜ ì‹œê°„ ê¸°ë‹¤ë¦¼
                     }, duration);
                 }
             }

             // --- í•µì‹¬ ê²Œì„ ë¡œì§ ---
             function submitGuess() {
                 if (gameOver) return;

                 const guess = guessInput.value.trim();

                 if (!guess) {
                     showMessage('ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error', 2000);
                     return;
                 }

                 guessCount++;
                 guessCountEl.textContent = `ì‹œë„: ${guessCount}`;

                 const guessRow = document.createElement('div');
                 guessRow.className = 'guess-row';

                 // ì›Œë“¤ ë¹„êµ ë¡œì§ (ìˆ˜ì •ë¨ - ìƒíƒœ ì €ì¥ í¬í•¨)
                 const results = new Array(Math.max(guess.length, targetWord.length)).fill(null);
                 const targetLetters = targetWord.split('');
                 const guessLetters = guess.split('');
                 const currentGuessStatuses = []; // <<--- í˜„ì¬ ì¶”ì¸¡ ê²°ê³¼ ìƒíƒœ ì €ì¥ìš©

                 const displayLength = Math.max(guess.length, targetWord.length);

                 // 1ë‹¨ê³„: Correct (ì´ˆë¡ìƒ‰)
                 for (let i = 0; i < displayLength; i++) {
                     if (i < guess.length && i < targetLetters.length && guessLetters[i] === targetLetters[i]) {
                         results[i] = 'correct';
                         targetLetters[i] = null; // ì‚¬ìš©ë¨ í‘œì‹œ
                         guessLetters[i] = null; // ì²˜ë¦¬ë¨ í‘œì‹œ
                     }
                 }

                 // 2ë‹¨ê³„: Present (ë…¸ë€ìƒ‰)
                 for (let i = 0; i < displayLength; i++) {
                     if (results[i] === null && i < guess.length && guessLetters[i] !== null) { // ì•„ì§ ì²˜ë¦¬ ì•ˆëê³ , ì¶”ì¸¡ ë¬¸ì ë‚¨ìŒ
                         if (i < targetWord.length) { // íƒ€ê²Ÿ ë²”ìœ„ ë‚´ì—ì„œë§Œ present í™•ì¸
                             const presentIndex = targetLetters.indexOf(guessLetters[i]);
                             if (presentIndex !== -1) {
                                 results[i] = 'present';
                                 targetLetters[presentIndex] = null; // ì‚¬ìš©ë¨ í‘œì‹œ (ì¤‘ë³µ ë°©ì§€)
                                 guessLetters[i] = null; // ì²˜ë¦¬ë¨ í‘œì‹œ
                             }
                         }
                     }
                 }

                 // 3ë‹¨ê³„: Absent (íšŒìƒ‰) ë° Excess (ë¹¨ê°„ìƒ‰) ì²˜ë¦¬ + ìƒíƒœ ì €ì¥
                 for (let i = 0; i < displayLength; i++) {
                    let status = '';
                    if (results[i] !== null) { // Correct or Present
                        status = results[i];
                    } else { // Absent or Excess
                        if (i < guess.length) { // ì¶”ì¸¡ ë¬¸ìê°€ ìˆëŠ” ê²½ìš°
                            if (i < targetWord.length) { // íƒ€ê²Ÿ ê¸¸ì´ ë‚´ë¶€ëŠ” Absent
                                status = 'absent';
                            } else { // íƒ€ê²Ÿ ê¸¸ì´ ì´ˆê³¼ëŠ” Excess
                                status = 'excess';
                            }
                        } else { // ì¶”ì¸¡ ë¬¸ìê°€ ì—†ëŠ” ê²½ìš° (guessê°€ targetë³´ë‹¤ ì§§ìŒ) - Absentë¡œ ì±„ì›€
                           status = 'absent';
                        }
                    }
                    results[i] = status; // ìµœì¢… ìƒíƒœ ì—…ë°ì´íŠ¸
                    currentGuessStatuses.push(status); // <<--- ê²°ê³¼ ê³µìœ ìš© ìƒíƒœ ì €ì¥
                 }

                 // DOM ìƒì„± ë¡œì§
                 for (let i = 0; i < displayLength; i++) {
                     const cell = document.createElement('div');
                     cell.className = 'guess-cell';
                     cell.style.animationDelay = `${i * 0.07}s`; // ì•½ê°„ì˜ ì• ë‹ˆë©”ì´ì…˜ ì§€ì—°

                     if (i < guess.length) {
                         cell.textContent = guess[i];
                     } else {
                         cell.textContent = ''; // ì¶”ì¸¡ì´ ì§§ìœ¼ë©´ ë¹ˆ ì¹¸
                     }
                     cell.classList.add(results[i]); // ê³„ì‚°ëœ ìƒíƒœ í´ë˜ìŠ¤ ì¶”ê°€
                     guessRow.appendChild(cell);
                 }

                 allGuessResults.push(currentGuessStatuses); // <<--- ì „ì²´ ê²°ê³¼ ë°°ì—´ì— í˜„ì¬ ì¶”ì¸¡ ê²°ê³¼ ì¶”ê°€
                 guessesContainer.appendChild(guessRow);
                 guessesContainer.scrollTop = guessesContainer.scrollHeight; // ìŠ¤í¬ë¡¤ ì•„ë˜ë¡œ
                 guessInput.value = '';
                 guessInput.focus();

                 // ì •ë‹µ í™•ì¸
                 if (guess === targetWord) {
                     gameOver = true;
                     clearInterval(timerInterval); // íƒ€ì´ë¨¸ ì •ì§€!
                     showMessage(`ì •ë‹µì…ë‹ˆë‹¤. ${guessCount}ë²ˆ ë§Œì— ì„±ê³µ! ğŸ‰`, 'success', 5000);
                     guessInput.disabled = true;
                     submitBtn.disabled = true;
                     shareBtn.disabled = false; // ê³µìœ  ë²„íŠ¼ í™œì„±í™”
                     celebrateWin();
                 } else {
                     // ì‹¤íŒ¨ ì‹œ ì´ìŠ¤í„°ì—ê·¸ ë“±
                     if (countEasterEggs[guessCount]) {
                         // ì•½ê°„ì˜ ë”œë ˆì´ í›„ í‘œì‹œ (í”Œë¦½ ì• ë‹ˆë©”ì´ì…˜ ëë‚  ë•Œì¯¤)
                         setTimeout(() => showMessage(countEasterEggs[guessCount], 'easter-egg'), 600);
                     }
                     for (const [word, message] of Object.entries(wordEasterEggs)) {
                         if (guess.includes(word)) {
                             setTimeout(() => showMessage(message, 'easter-egg'), 800);
                             break;
                         }
                     }
                 }
             }

             // ìŠ¹ë¦¬ ì¶•í•˜ í•¨ìˆ˜ (ë³„ë„ ë©”ì‹œì§€ í‘œì‹œìš©)
             function celebrateWin() {
                 // ê¸°ì¡´ ì¶•í•˜ ë©”ì‹œì§€ ì œê±° (í˜¹ì‹œ ëª¨ë¥¼ ì¤‘ë³µ ë°©ì§€)
                 const existingCongrats = document.querySelector('.congrats-message');
                 if (existingCongrats) existingCongrats.remove();

                 const formattedTime = formatTime(elapsedTime);
                 const congratsText = document.createElement('div');
                 congratsText.className = 'congrats-message'; // í´ë˜ìŠ¤ ì¶”ê°€
                 congratsText.innerHTML = `<strong>${guessCount}ë²ˆ</strong> ì‹œë„, <strong>${formattedTime}</strong> ë§Œì— ì„±ê³µ! ğŸŠ`;
                 congratsText.style.cssText = `
                     font-size: 1.1rem;
                     text-align: center;
                     margin: 1rem 0 0; /* ìœ„ìª½ ì—¬ë°± ì¶”ê°€ */
                     color: #388e3c; /* Success color */
                     font-weight: 600;
                 `;
                 // ê²Œì„ ì»¨í…Œì´ë„ˆì˜ ë©”ì‹œì§€ ì˜ì—­ ì•„ë˜ì— ì¶”ê°€
                 document.querySelector('.game-container .stats').insertAdjacentElement('afterend', congratsText);
             }


             // --- ì‹œê°ì  ê²°ê³¼ ìƒì„± ë° ê³µìœ  ---

             // ì‹œê°ì  ê²°ê³¼ ê·¸ë¦¬ë“œ HTML ìƒì„± (ëª¨ë‹¬ í‘œì‹œìš©)
             function generateShareableResultHtml() {
                 // ì‚¬ìš©ìê°€ ìš”ì²­í•œ ìƒ‰ìƒ ë§¤í•‘ (<font> íƒœê·¸ ì‚¬ìš©)
                 const colorMap = {
                    // Hex codes from decimal values provided or CSS:
                                        correct: '<font color=#69d953>â–ˆ</font>', // 7134297
                    present: '<font color=#f5d139>â–ˆ</font>', // 16374097
                    absent:  '<font color=#9e9e9e>â–ˆ</font>', // Using darker gray for better visibility than #EFEFEF (15724527)
                    excess:  '<font color=#ef5350>â–ˆ</font>', // Using CSS red
                 };

                 let gridHtml = '';
                 allGuessResults.forEach(row => {
                     row.forEach(status => {
                         gridHtml += colorMap[status] || colorMap['absent']; // ìƒíƒœì— ë§ëŠ” ë¸”ë¡ ì¶”ê°€
                     });
                     gridHtml += '<br>'; // HTML ì¤„ë°”ê¿ˆ
                 });
                 return gridHtml;
             }

             // ê³µìœ ìš© ì¼ë°˜ í…ìŠ¤íŠ¸ ê²°ê³¼ ìƒì„± (í´ë¦½ë³´ë“œ ë³µì‚¬ìš©)
             function generateShareableResultPlainText() {
                 const title = `ë‰´ë“¤ ${isCustomMode ? '(ì»¤ìŠ¤í…€)' : ''} ${guessCount}/${allGuessResults.length} | â±ï¸${formatTime(elapsedTime)}`;
                 // ì¼ë°˜ í…ìŠ¤íŠ¸ìš© ì´ëª¨ì§€ ë§¤í•‘ (ë” í‘œì¤€ì )
                 const plainBlockMap = {
                    correct: '<font color=6543440>â–ˆ</font>',
                    present: '<font color=16373577>â–ˆ</font>',
                    absent:  '<font color=10395294>â–ˆ</font>',
                    excess:  '<font color=16403275>â–ˆ</font>',
                 };

                 let gridPlainText = '';
                 allGuessResults.forEach(row => {
                     row.forEach(status => {
                         gridPlainText += plainBlockMap[status] || plainBlockMap['absent'];
                     });
                     gridPlainText += '\n'; // ì¼ë°˜ í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ
                 });

                 const currentUrl = `${window.location.origin}${window.location.pathname}${window.location.search}`; // í˜„ì¬ URL ê·¸ëŒ€ë¡œ ì‚¬ìš©

                 return `${title}\n\n${gridPlainText}\n${currentUrl}`;
             }


             // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
             submitBtn.addEventListener('click', submitGuess);
             guessInput.addEventListener('keypress', function(e) {
                 if (e.key === 'Enter') {
                     submitGuess();
                 }
             });

             // ì»¤ìŠ¤í…€ ë‹¨ì–´ ëª¨ë‹¬ ì—´ê¸°
             customBtn.addEventListener('click', function() {
                 customModal.style.display = 'flex';
                 customWordInput.value = '';
                 customWordInput.focus();
             });

             // ì»¤ìŠ¤í…€ ë‹¨ì–´ ì €ì¥ ë° URL ìƒì„±/ë³µì‚¬
             saveCustomBtn.addEventListener('click', function() {
                 const word = customWordInput.value.trim();
                 if (word && word.length > 0) {
                     if (word.length > 30) { // ë‹¨ì–´ ê¸¸ì´ ì œí•œ (ì„ íƒ ì‚¬í•­)
                         alert('ë‹¨ì–´ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. 30ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                         return;
                     }
                     const encodedWord = encodeBase64(word);
                     if (!encodedWord) {
                         alert('ë‹¨ì–´ ì¸ì½”ë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                         return;
                     }
                     const url = `${window.location.origin}${window.location.pathname}?word=${encodedWord}`;

                     // URLì„ í´ë¦½ë³´ë“œì— ë³µì‚¬ (Clipboard API ì‚¬ìš©)
                     navigator.clipboard.writeText(url).then(() => {
                         alert(`URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n${url}\n\nì´ URLì„ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”! Letgo`);
                         customModal.style.display = 'none';
                     }).catch(err => {
                         console.error('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                         alert('URL ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì™œì§€?? ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.ã…ã…:\n' + url);
                     });

                 } else {
                     alert('ìœ íš¨í•œ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                 }
             });


             // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ë“¤
             cancelCustomBtn.addEventListener('click', () => customModal.style.display = 'none');
             closeResultBtn.addEventListener('click', () => resultModal.style.display = 'none');

             // ê²°ê³¼ ê³µìœ  ë²„íŠ¼ (íˆ´ë°”) - ëª¨ë‹¬ ì—´ê¸°
             shareBtn.addEventListener('click', function() {
                 if (!gameOver) return; // ê²Œì„ ì¢…ë£Œ ì‹œì—ë§Œ í™œì„±í™”

                 const formattedTime = formatTime(elapsedTime);
                 const summaryText = `ë‰´ë“¤ ${isCustomMode ? '(ì»¤ìŠ¤í…€)' : ''} ${guessCount}ë²ˆ ì‹œë„, ${formattedTime} ë§Œì— í•´ê²°!`;
                 const gridHtml = generateShareableResultHtml();
                 const currentUrl = `${window.location.origin}${window.location.pathname}${window.location.search}`;

                 // ëª¨ë‹¬ ë‚´ìš© êµ¬ì„± (HTML ì‚¬ìš©)
                 resultContent.innerHTML = `
                     <div class="result-summary">${summaryText}</div>
                     <div class="result-grid">${gridHtml}</div>
                     <div class="result-url">${currentUrl}</div>
                 `;
                 resultModal.style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ
             });

            // ê²°ê³¼ ë³µì‚¬ ë²„íŠ¼ (ëª¨ë‹¬ ì•ˆ) - í´ë¦½ë³´ë“œì— ë³µì‚¬
            copyResultBtn.addEventListener('click', function() {
                const plainTextResult = generateShareableResultPlainText(); // ì¼ë°˜ í…ìŠ¤íŠ¸ ë²„ì „ ìƒì„±

                // Clipboard API ì‚¬ìš©
                navigator.clipboard.writeText(plainTextResult).then(() => {
                    alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (í…ìŠ¤íŠ¸ í˜•ì‹)');
                    // resultModal.style.display = 'none'; // ë³µì‚¬ í›„ ë‹«ê¸° (ì„ íƒ ì‚¬í•­)
                }).catch(err => {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì˜¤ë¥˜:', err);
                    // êµ¬ì‹ ë°©ë²• ì‹œë„ (fallback) - í…ìŠ¤íŠ¸ ì˜ì—­ ì‚¬ìš©
                    try {
                        const textArea = document.createElement('textarea');
                        textArea.value = plainTextResult;
                        textArea.style.position = 'fixed'; // í™”ë©´ ë°–ì— ìœ„ì¹˜
                        textArea.style.left = '-9999px';
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (í…ìŠ¤íŠ¸ - Fallback)');
                    } catch (execErr) {
                        console.error('Fallback ë³µì‚¬ ì˜¤ë¥˜:', execErr);
                        alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            });


             // ìƒˆ ê²Œì„ ë²„íŠ¼
             resetBtn.addEventListener('click', function() {
                 if (confirm('í˜„ì¬ ê²Œì„ ì§„í–‰ ìƒí™©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.\n ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                     // ì»¤ìŠ¤í…€ ëª¨ë“œì˜€ë‹¤ë©´, URL íŒŒë¼ë¯¸í„° ì—†ì´ í˜ì´ì§€ë¥¼ ë¦¬ë¡œë“œí•˜ì—¬ ê¸°ë³¸ ë‹¨ì–´ë¡œ ì‹œì‘
                     if (isCustomMode) {
                         window.location.href = window.location.pathname;
                     } else {
                         resetGame(); // ê¸°ë³¸ ëª¨ë“œë©´ ìƒíƒœë§Œ ë¦¬ì…‹
                     }
                 }
             });

             // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
             window.addEventListener('click', function(e) {
                 if (e.target === customModal) customModal.style.display = 'none';
                 if (e.target === resultModal) resultModal.style.display = 'none';
             });

            // --- ê²Œì„ ì‹œì‘ ---
            initializeGame();

        }); // End DOMContentLoaded
    </script>
</body>
</html>
